<?php
    function chsubject($a){
        if($a=="AC ENG")
            $a="Academic English and ESL";
        else if($a=="AFAM")
            $a="African American Studies";
        else if($a=="ANATOMY")
            $a="Anatomy and Neurobiology";
        else if($a=="ANESTH")
            $a="Anesthesiology";
        else if($a=="ANTHRO")
            $a="Anthropology";
        else if($a=="ARABIC")
            $a="Arabic";
        else if($a=="ART")
            $a="Art";
        else if($a=="ART HIS")
            $a="Art History";
        else if($a=="ARTS")
            $a="Arts";
        else if($a=="ARTSHUM")
            $a="Arts and Humanities";
        else if($a=="ASIANAM")
            $a="Asian American Studies";
        else if($a=="BATS")
            $a="Biomedical and Translational Science";
        else if($a=="BIO SCI")
            $a="Biological Sciences";
        else if($a=="BIOCHEM")
            $a="Biological Chemistry";
        else if($a=="BME")
            $a="Biomedical Engineering";
        else if($a=="BSEMD")
            $a="Bio Sci & Educational Media Design";
        else if($a=="CAMPREC")
            $a="Campus Recreation";
        else if($a=="CBEMS")
            $a="Chemical Engr and Materials Science";
        else if($a=="CEM")
            $a="Community and Environmental Medicine";
        else if($a=="CHC/LAT")
            $a="Chicano/Latino Studies";
        else if($a=="CHEM")
            $a="Chemistry";
        else if($a=="CHINESE")
            $a="Chinese";
        else if($a=="CLASSIC")
            $a="Classics";
        else if($a=="CLT&THY")
            $a="Culture & Theory";
        else if($a=="COM LIT")
            $a="Comparative Literature";
        else if($a=="COMPSCI")
            $a="Computer Science";
        else if($a=="CRITISM")
            $a="Criticism";
        else if($a=="CRM/LAW")
            $a="Criminology, Law and Society";
        else if($a=="CSE")
            $a="Computer Science and Engineering";
        else if($a=="DANCE")
            $a="Dance";
        else if($a=="DERM")
            $a="Dermatology";
        else if($a=="DEV BIO")
            $a="Developmental and Cell Biology";
        else if($a=="DRAMA")
            $a="Drama";
        else if($a=="E ASIAN")
            $a="East Asian Languages and Literatures";
        else if($a=="EARTHSS")
            $a="Earth System Science";
        else if($a=="ECO EVO")
            $a="Ecology and Evolutionary Biology";
        else if($a=="ECON")
            $a="Economics";
        else if($a=="ED AFF")
            $a="Educational Affairs (Sch of Med)";
        else if($a=="EDUC")
            $a="Education";
        else if($a=="EECS")
            $a="Electrical Engineering & Computer Science";
        else if($a=="ENGLISH")
            $a="English";
        else if($a=="ENGR")
            $a="Engineering";
        else if($a=="ENGRCEE")
            $a="Engineering, Civil and Environmental";
        else if($a=="ENGRMAE")
            $a="Engineering, Mechanical and Aerospace";
        else if($a=="ENGRMSE")
            $a="Chemical Engr and Materials Science (grads)";
        else if($a=="EPIDEM")
            $a="Epidemiology";
        else if($a=="ER MED")
            $a="Emergency Medicine";
        else if($a=="EURO ST")
            $a="European Studies";
        else if($a=="FAM MED")
            $a="Family Medicine";
        else if($a=="FLM&MDA")
            $a="Film and Media Studies";
        else if($a=="FRENCH")
            $a="French";
        else if($a=="GERMAN")
            $a="German";
        else if($a=="GLBLCLT")
            $a="Global Cultures";
        else if($a=="GREEK")
            $a="Greek";
        else if($a=="HEBREW")
            $a="Hebrew";
        else if($a=="HINDI")
            $a="Hindi";
        else if($a=="HISTORY")
            $a="History";
        else if($a=="HUMAN")
            $a="Humanities";
        else if($a=="HUMARTS")
            $a="Humanities and Arts";
        else if($a=="I&C SCI")
            $a="Information and Computer Science";
        else if($a=="IN4MATX")
            $a="Informatics";
        else if($a=="INT MED")
            $a="Internal Medicine";
        else if($a=="INTL ST")
            $a="International Studies";
        else if($a=="ITALIAN")
            $a="Italian";
        else if($a=="JAPANSE")
            $a="Japanese";
        else if($a=="KOREAN")
            $a="Korean";
        else if($a=="LATIN")
            $a="Latin";
        else if($a=="LAW")
            $a="Law";
        else if($a=="LINGUIS")
            $a="Linguistics";
        else if($a=="LIT JRN")
            $a="Literary Journalism";
        else if($a=="LPS")
            $a="Logic and Philosophy of Science";
        else if($a=="M&MG")
            $a="Microbiology and Molecular Genetics";
        else if($a=="MATH")
            $a="Mathematics";
        else if($a=="MED")
            $a="Medicine";
        else if($a=="MED ED")
            $a="Medical Education";
        else if($a=="MGMT")
            $a="Management";
        else if($a=="MGMT EP")
            $a="Executive MBA";
        else if($a=="MGMT FE")
            $a="Fully Employed MBA";
        else if($a=="MGMT HC")
            $a="Health Care MBA";
        else if($a=="MGMTMBA")
            $a="Management MBA";
        else if($a=="MGMTPHD")
            $a="Management PhD";
        else if($a=="MIC BIO")
            $a="Microbiology";
        else if($a=="MOL BIO")
            $a="Molecular Biology and Biochemistry";
        else if($a=="MPAC")
            $a="Accounting";
        else if($a=="MUSIC")
            $a="Music";
        else if($a=="NET SYS")
            $a="Networked Systems";
        else if($a=="NEURBIO")
            $a="Neurobiology and Behavior";
        else if($a=="NEUROL")
            $a="Neurology";
        else if($a=="NUR SCI")
            $a="Nursing Science";
        else if($a=="OB/GYN")
            $a="Obstetrics and Gynecology";
        else if($a=="OPHTHAL")
            $a="Ophthalmology";
        else if($a=="PATH")
            $a="Pathology and Laboratory Medicine";
        else if($a=="PED GEN")
            $a="Pediatrics Genetics";
        else if($a=="PEDS")
            $a="Pediatrics";
        else if($a=="PERSIAN")
            $a="Persian";
        else if($a=="PHARM")
            $a="Medical Pharmacology";
        else if($a=="PHILOS")
            $a="Philosophy";
        else if($a=="PHRMSCI")
            $a="Pharmaceutical Sciences";
        else if($a=="PHY SCI")
            $a="Physical Science";
        else if($a=="PHYSICS")
            $a="Physics";
        else if($a=="PHYSIO")
            $a="Physiology and Biophysics";
        else if($a=="PM&R")
            $a="Physical Medicine and Rehabilitation";
        else if($a=="POL SCI")
            $a="Political Science";
        else if($a=="PORTUG")
            $a="Portuguese";
        else if($a=="PP&D")
            $a="Planning, Policy, and Design";
        else if($a=="PSY BEH")
            $a="Psychology and Social Behavior";
        else if($a=="PSYCH")
            $a="Cognitive Sciences";
        else if($a=="PUB POL")
            $a="Public Policy";
        else if($a=="PUBHLTH")
            $a="Public Health";
        else if($a=="RADIO")
            $a="Radiology";
        else if($a=="REL STD")
            $a="Religious Studies";
        else if($a=="ROTC")
            $a="Reserve Officers' Training Corps";
        else if($a=="RUSSIAN")
            $a="Russian";
        else if($a=="SOC SCI")
            $a="Social Science";
        else if($a=="SOCECOL")
            $a="Social Ecology";
        else if($a=="SOCIOL")
            $a="Sociology";
        else if($a=="SPANISH")
            $a="Spanish";
        else if($a=="STATS")
            $a="Statistics";
        else if($a=="SURGERY")
            $a="Surgery";
        else if($a=="TAGALOG")
            $a="Tagalog";
        else if($a=="TOX")
            $a="Toxicology";
        else if($a=="UCDC")
            $a="UC Washington DC";
        else if($a=="UNI AFF")
            $a="University Affairs";
        else if($a=="UNI STU")
            $a="University Studies";
        else if($a=="VIETMSE")
            $a="Vietnamese";
        else if($a=="VIS STD")
            $a="Visual Studies";
        else if($a=="WOMN ST")
            $a="Women's Studies";
        else if($a=="WRITING")
            $a="Writing";
        return $a;
    }
    
    function chtype($a){
        if($a=="ACT")
            $a="Activity";
        else if($a=="COL")
            $a="Colloquium";
        else if($a=="DIS")
            $a="Discussion";
        else if($a=="FLD")
            $a="Field Work";
        else if($a=="LAB")
            $a="Laboratory";
        else if($a=="LEC")
            $a="Lecture";
        else if($a=="QIZ")
            $a="Quiz";
        else if($a=="RES")
            $a="Research";
        else if($a=="SEM")
            $a="Seminar";
        else if($a=="STU")
            $a="Studio";
        else if($a=="TAP")
            $a="Tutorial Assist Program";
        else if($a=="TUT")
            $a="Tutorial";
        return $a;
    }
    
    function chbuilding($a){
        if($a=="BS3")
            $a="Biological Sciences III";
        else if($a=="DBH")
            $a="Donald Bren Hall";
        else if($a=="ECT")
            $a="Engineering & Computing Trailer";
        else if($a=="EH")
            $a="Engineering Hall";
        else if($a=="ELH")
            $a="Engineering Lecture Hall";
        else if($a=="ET")
            $a="Engineering Tower";
        else if($a=="HG")
            $a="Humanities Gateway";
        else if($a=="HH")
            $a="Humanities Hall";
        else if($a=="HIB")
            $a="Humanities Instructional Building";
        else if($a=="HICF")
            $a="Humanities Interim Classroom Facility";
        else if($a=="HSLH")
            $a="Howard Schneiderman Lecture Hall";
        else if($a=="IAB")
            $a="Intercollegiate Athletics Building";
        else if($a=="ICF")
            $a="Interim Classroom Facility";
        else if($a=="ICS")
            $a="Information & Computer Science";
        else if($a=="MM")
            $a="Music & Media Building";
        else if($a=="MPAA")
            $a="Multipurpose Acadamic & Administrative Building";
        else if($a=="MSTB")
            $a="Multipurpose Science & Technology Building";
        else if($a=="PCB")
            $a="Parkview Classroom Building";
        else if($a=="PSCB")
            $a="Physical Sciences Classroom Building";
        else if($a=="PSLH")
            $a="Physical Sciences Lecture Hall";
        else if($a=="RH")
            $a="Rowland Hall";
        else if($a=="SE2")
            $a="Social Ecology II";
        else if($a=="SH")
            $a="Steinhaus Hall";
        else if($a=="SSH")
            $a="Social Science Hall";
        else if($a=="SSL")
            $a="Social Science Lab";
        else if($a=="SSLH")
            $a="Social Science Lecture Hall";
        else if($a=="SSPA")
            $a="Social Science Plaza A";
        else if($a=="SST")
            $a="Social Science Tower";
        else if($a=="SSTR")
            $a="Social Science Trailer";
        return $a;
    }
    
    $name=strtolower(trim($_POST["user"]));
    
    $fp=preg_split("/\n/",$_POST["schd"]);
    
    function ast($x,$hm){
        $ret=(int)substr($x,$hm*2,2);
        if($ret==0){
            return "00";
        }
        else{
            return $ret;
        }
    }
    
    $i=0;
    foreach($fp as $k){
        $k=trim($k);
        if(strlen($k)<60 || strpos($k,"Num  Typ Num Unts Opt    Days    Time          Bldg Room")!==false){
            continue;
        }
        else{
            sscanf($k,"%d %7[^\n]%s%s%18[^\n]%5[^\n]%s%s%s",$code[$i],$subject[$i],$class[$i],$type[$i],$trash,$days[$i],$time[$i],$building[$i],$room[$i]);
            $subject[$i]=trim($subject[$i]);
            $days[$i]=str_replace(" ","-",$days[$i]);
            
            $aessubject[$i]=chsubject($subject[$i]);
            $aestype[$i]=chtype($type[$i]);
            $aesbuilding[$i]=chbuilding($building[$i]);
            
            $xtime[$i]=explode("-",str_replace(":","",$time[$i]));
            for($j=0;$j<2;$j++){
                $ampm[$i][$j]="AM";
                $rtime[$i][$j]=(int)$xtime[$i][$j];
                if($rtime[$i][$j]<800 || $rtime[$i][$j]>=1200 || strlen($time[$i])>11){
                    $rtime[$i][$j]+=1200;
                    $ampm[$i][$j]="PM";
                    if($rtime[$i][$j]>=2400){
                    	$rtime[$i][$j]-=1200;
                    }
                }
            }
            $aestime[$i]=ast($xtime[$i][0],0).":".ast($xtime[$i][0],1)." ".$ampm[$i][0]." - ".ast($xtime[$i][1],0).":".ast($xtime[$i][1],1)." ".$ampm[$i][1];
        }
        $i++;
    }
    //unset($subject);
    unset($trash);
    unset($time);
    unset($xtime);
    unset($ampm);
    
    function swap(&$x,&$y,&$z){
        $w=$x[$y];
        $x[$y]=$x[$z];
        $x[$z]=$w;
    }
    
    for($j=0;$j<$i-1;$j++){
        for($k=$j+1;$k<$i;$k++){
            $temp[0]=10000*$rtime[$j][0]+$rtime[$j][1];
            $temp[1]=10000*$rtime[$k][0]+$rtime[$k][1];
            if($temp[0]>$temp[1]){
                swap($code,$j,$k);
                swap($class,$j,$k);
                swap($type,$j,$k);
                swap($days,$j,$k);
                swap($building,$j,$k);
                swap($room,$j,$k);
                
                swap($aessubject,$j,$k);
                swap($aestype,$j,$k);
                swap($aesbuilding,$j,$k);
                
                swap($rtime,$j,$k);
                swap($aestime,$j,$k);
            }
        }
    }
    unset($temp);
    
    /*
     $end=$i;
     unset($fp);
     unset($i);
     unset($j);
     unset($k);
     */
?>
